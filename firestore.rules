rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Cities data - public read, admin write
    match /cities/{document} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.token.admin == true;
    }
    
    // Travel packages - public read, admin write
    match /travels/{document} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.token.admin == true;
    }
    
    // Experiences - public read, admin write
    match /experiences/{document} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.token.admin == true;
    }
    
    // Bookings - owner can read/write their own, admin can read/write all
    match /bookings/{document} {
      allow create: if true; // Allow anonymous bookings
      allow read, write: if request.auth != null && (request.auth.token.admin == true || resource.data.userId == request.auth.uid);
    }
    
    // CMS content - admin only write, published content public read
    match /cms_content/{document} {
      allow read: if resource.data.published == true || (request.auth != null && request.auth.token.admin == true);
      allow write: if request.auth != null && request.auth.token.admin == true;
    }
    
    match /cms_sections/{document} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.token.admin == true;
    }
    
    // Package components and templates - public read, admin write
    match /package_components/{document} {
      allow read: if resource.data.available == true || (request.auth != null && request.auth.token.admin == true);
      allow write: if request.auth != null && request.auth.token.admin == true;
    }
    
    match /package_templates/{document} {
      allow read: if resource.data.available == true || (request.auth != null && request.auth.token.admin == true);
      allow write: if request.auth != null && request.auth.token.admin == true;
    }
    
    // Guides - admin only write, public read based on visibility
    match /guides/{document} {
      allow read: if resource.data.isPublic == true || (request.auth != null && request.auth.token.admin == true);
      allow write: if request.auth != null && request.auth.token.admin == true;
    }
    
    // Users - users can read/write their own data, admin can read/write all
    match /users/{userId} {
      allow read, write: if request.auth != null && (request.auth.uid == userId || request.auth.token.admin == true);
    }
    
    // Inquiries - allow creation, admin can read/write
    match /inquiries/{document} {
      allow create: if true; // Allow anonymous inquiries
      allow read, write: if request.auth != null && request.auth.token.admin == true;
    }
    
    // Blog posts - public read for published, admin write
    match /blog/{document} {
      allow read: if resource.data.published == true || (request.auth != null && request.auth.token.admin == true);
      allow write: if request.auth != null && request.auth.token.admin == true;
    }
    
    // User themes - user can read/write their own, admin can read/write all
    match /user_themes/{document} {
      allow read, write: if request.auth != null && (resource.data.userId == request.auth.uid || request.auth.token.admin == true);
    }
    
    // Analytics - admin only
    match /analytics/{document} {
      allow read, write: if request.auth != null && request.auth.token.admin == true;
    }
    
    // Services - admin only write, public read
    match /services/{document} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.token.admin == true;
    }
    
    // Site content - admin only write, public read
    match /site_content/{document} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.token.admin == true;
    }
    
    // Instagram videos - public read, authenticated users can write
    match /instagram_videos/{document} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // User profiles - user can read/write their own, admin can read/write all
    match /userProfiles/{userId} {
      allow read, write: if request.auth != null && (request.auth.uid == userId || request.auth.token.admin == true);
    }
    
    // Custom trip requests - owner can read/write their own, admin can read/write all
    match /customTripRequests/{document} {
      allow create: if true; // Allow anonymous requests
      allow read, write: if request.auth != null && (resource.data.userId == request.auth.uid || request.auth.token.admin == true);
    }
    
    // Admin users collection - admin only
    match /adminUsers/{document} {
      allow read, write: if request.auth != null && request.auth.token.admin == true;
    }
  }
}